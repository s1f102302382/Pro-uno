# Pro-uno
websocket with django

# リアルタイム対戦型UNOゲーム

## 概要 📝

このプロジェクトは、複数人がリアルタイムで対戦できるUNOゲームのバックエンド（サーバーサイド）です。Django Channelsを利用してWebSocket通信を実装し、各プレイヤーのアクションが即座にゲーム全体に反映されるよう設計しました。

## 主な機能 ✨

-   **リアルタイムなゲーム進行**: WebSocketにより、全プレイヤーのゲーム状況が遅延なく同期されます。
-   **UNOの基本ルール実装**:
    -   カードを出す、山札から引くといった基本アクション
    -   スキップ、リバース、ドロー2、ドロー4などの特殊カード効果
    -   自動でのターン管理と進行方向の制御
-   **複数プレイヤー対応**: 複数人が同じルームに参加し、対戦することが可能です。

## 使用技術 💻

-   **言語**: Python
-   **フレームワーク**: Django, Django Channels
-   **通信プロトコル**: WebSocket

## セットアップ手順 🚀

1.  **リポジトリをクローン**
    ```bash
    git clone https://github.com/s1f102302382/Pro-uno
    cd Pro-uno
    ```

2.  **仮想環境の作成と有効化**
    ```bash
    # Pythonの仮想環境を作成
    python -m venv venv

    # 仮想環境を有効化 (Mac/Linux)
    source venv/bin/activate
    # (Windows)
    # .\venv\Scripts\activate
    ```

3.  **必要なライブラリをインストール**
    ```bash
    pip install -r requirements.txt
    ```

4.  **サーバーを起動**
    ```bash
    python manage.py runserver
    ```
     `ws://127.0.0.1:8000/uno` にアクセスして、ルーム名とプレイヤー名を入力して、ゲーム開始！

## API仕様 (WebSocket) 📡

サーバーはJSON形式のメッセージを送受信します。

### クライアント → サーバー

-   **参加時**
    ```json
    {
      "action": "join",
      "player": "プレイヤー名"
    }
    ```
-   **カードを出す時**
    ```json
    {
      "action": "play_card",
      "player": "プレイヤー名",
      "card": [カードを表す数値]
    }
    ```

### サーバー → クライアント

-   **ゲーム状況の更新**
    ```json
    {
      "type": "game-update",
      "turn": [現在のターンプレイヤーのインデックス],
      "next_player": "次のプレイヤー名",
      "top_card": [捨て札の一番上のカード],
      "player": {
        "player1": [手札の枚数],
        "player2": [手札の枚数]
      }
    }
    ```

## 設計のハイライト：数値によるカード表現とアルゴリズム 💡

このプロジェクトで最も注力した点の一つが、カードのデータ構造設計です。

UNOのカードが持つ「色」「数字」「役（スキップなど）」という複数の属性を、文字列ではなく**独自のルールに基づいた単一の数値**で表現しました。（例: 赤の3→`3`, 青のスキップ→`140`）

### この設計のメリット

-   **判定ロジックの簡潔化**: カードが場に出せるかどうかの判定（同じ色か？同じ数字か？）を、複雑な文字列比較ではなく、**剰余演算 (`%`) や商の計算 (`//`) といったシンプルな数値計算**で実装できました。
-   **効率性**: 数値計算は文字列比較よりも高速に動作するため、パフォーマンスの向上に繋がります。
-   **拡張性**: 将来的に新しい種類のカードを追加する際も、新しい数値ルールを定義するだけで容易に対応できます。

この設計を通して、複雑なルールをいかにシンプルなアルゴリズムに落とし込むかという、問題解決のプロセスを実践しました。

## 今後の課題・改善点 🧠

-   **複数ルームへの対応**: 現在は全てのプレイヤーが1つのゲームを共有する状態のため、ルームごとにゲーム状態を独立させるリファクタリング。
-   **テストコードの実装**: 各関数のロジックを保証するための単体テストを追加する。
-   **エラーハンドリングの強化**: 予期せぬアクションに対するサーバーの安定性を向上させる。
